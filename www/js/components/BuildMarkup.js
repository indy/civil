import { h } from '/lib/preact/mod.js';
import { useWasmInterface } from '/js/WasmInterfaceProvider.js';

// build the Preact structure from the AST generated by rust
//
export default function buildMarkup(content, imageDirectory) {
  const wasmInterface = useWasmInterface();
  const astArray = wasmInterface.asHtmlAst(content);

  function attrs(n) {
    let res = {
      key: n.key,
      class: n.class_name,
      for: n.html_for,
      href: n.href,
      type: n.html_type,
      id: n.id
    }

    if (n.src) {
      res.src = `/u/${imageDirectory}/${n.src}`;
    }

    return res;
  }

  function compile(n) {
    return n.name === "text" ? n.text : h(n.name, attrs(n), ...n.children.map(compile));
  }

  return astArray.map(compile);
}
